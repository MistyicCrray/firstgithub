<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>去哪儿买后台管理系统-登录</title>
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />

		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="./css/font.css">
		<link rel="stylesheet" href="./css/xadmin.css">
		<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
		<script src="./lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="./js/xadmin.js"></script>
	</head>

	<body class="login-bg">

		<div class="login layui-anim layui-anim-up" id="app">
			<div class="message">去哪儿买后台-管理登录</div>
			<div id="darkbannerwrap"></div>

			<form method="post" class="layui-form" @submit.prevent="submit">
				<input name="username" placeholder="用户名" type="text" lay-verify="required" class="layui-input" v-model="inputtext.loginname">
				<hr class="hr15">
				<input name="password" lay-verify="required" placeholder="密码" type="password" class="layui-input" v-model="inputtext.password">
				<hr class="hr15">
				<input name="password" type="checkbox" id="remenber" class="layui-input" v-model="inputtext.remenber">记住密码
				<input name="password" type="checkbox" id="autoLogin" class="layui-input" v-model="inputtext.autoLogin">自动登录
				<hr class="hr15">
				<input value="登录" lay-submit lay-filter="login" style="width:100%;" type="button" v-on:click="submit">
				<hr class="hr20">
			</form>
		</div>
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript" src="js/vue-2.5.17.min.js"></script>
		<script type="text/javascript" src="js/axios-0.18.min.js"></script>
		<script type="text/javascript" src="js/vue-main.js"></script>
		<script type="text/javascript" src="js/moment.min.js"></script>
		<script type="text/javascript" src="js/base64.js"></script>
		<script type="text/javascript" src="js/layer.js"></script>
		<script type="text/javascript">
			var app = new Vue({
				el: '#app',
				data: {
					user: {},
					islogin: sessionStorage.length > 0,
					inputtext: {
						loginname: '',
						password: ''
					}
				},
				// 在 `methods` 对象中定义方法
				methods: { // 获取类别信息
					setCookie: function(cname, cvalue, exdays) {
						var d = new Date();
						var b = new Base64();
						var str = b.encode(cvalue); // 加密
						d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
						document.cookie = cname + "=" + str + "; ";
					},
					getCookie: function(cname) {
						var name = cname + "=";
						var ca = document.cookie.split(';');
						var b = new Base64();
						for(var i = 0; i < ca.length; i++) {
							var c = ca[i];
							while(c.charAt(0) == ' ') c = c.substring(1);
							if(c.indexOf(name) != -1) {
								var cnameValue = unescape(c.substring(name.length, c.length));
								return b.decode(cnameValue); // 解密
							}
						}
						return "";
					},
					autoLogin: function() {
						var _this = this;
						_this.inputtext.password = _this.getCookie("password");
						_this.inputtext.loginname = _this.getCookie("loginname");
						_this.inputtext.remenber = _this.getCookie("remenber");
						_this.inputtext.autoLogin = _this.getCookie("autoLogin");
						if(document.getElementById("autoLogin").checked) {
							layer.msg('自动登陆中...', {
								time: 2000, //2s后自动关闭
								btn: ['取消'],
								shade: 0.5,
								yes: function(index) {
									layer.close(index);
									_this.login.autoLogin = false;
								}
							});
						}
						if(document.getElementById("autoLogin").checked) {
							setTimeout(function() {
								if(document.getElementById("autoLogin").checked) {
									_this.submit();
								}      
							}, 2000)
						}
					},
					submit: function() {
						var _this = this;
						axios.post('/user/Login', _this.inputtext)
							.then(function(response) {
								console.info(response.data.code);
								if(response.data.code == 200) {
									console.info(response);
									sessionStorage.setItem("userId", response.data.data.userInfo.id);
									sessionStorage.setItem("username", response.data.data.userInfo.username);
									sessionStorage.setItem("accessToken", response.data.data.accessToken);
									if(_this.inputtext.remenber) {
										_this.setCookie("loginName", _this.inputtext.loginName, 7);
										_this.setCookie("password", _this.inputtext.password, 7);
										_this.setCookie("remenber", "true", 7);
										_this.setCookie("autoLogin", "", 7);
									} else {
										document.cookie = "";
									}
									if(_this.inputtext.autologin) {
										_this.setCookie("loginName", _this.inputtext.loginName, 7);
										_this.setCookie("password", _this.inputtext.password, 7);
										_this.setCookie("remenber", "true", 7);
										_this.setCookie("autoLogin", "true", 7);
									} else {
										document.cookie = "";
									}
									alert("登录成功");
									if(response.data.data.userInfo.usertype == 1) {
										window.location.href = '/admin/index.html';
									} else {
										window.location.href = '/cpts_1293_byy/index.html';
									}
								} else {
									console.info(response.data.code);
									alert(response.data.message);
								}

							})
							.catch(function(err) {});
					}
				},
				mounted: function() {
					this.autoLogin();
				}
			})
		</script>
	</body>

</html>